app.controller("ctrl-update",["$scope","Dataservice",function($scope,Dataservice){function loadData(dataService){$scope.nameEstablishment=dataService.Nombre_establecimiento,$scope.id=dataService.establecimientID,document.getElementById("id").value=dataService.idestablecimiento,document.getElementById("nombre").value=dataService.Nombre_establecimiento,document.getElementById("telefono").value=dataService.Telefono,document.getElementById("direccion").value=dataService.Direccion,document.getElementById("precio").value=dataService.Precio,document.getElementById("promocion").value=dataService.Promociones,document.getElementById("mapa").value=dataService.mapa,document.getElementById("nameImagen").value=dataService.imagenPrincipal,document.getElementById("PrincipalService").value=dataService.servicioPrincipal,document.getElementById("services").value=dataService.servicios,document.getElementById("methodPay").value=dataService.methodpay,FuncValidateProduction(dataService),UpdateImages(),disabledButtons(!1)}function loadHours(dataService){$.ajax({type:"POST",url:UrlHorario,timeout:2e3,data:{id:dataService.idestablecimiento},success:function(data){var horarioApertura=data.result.Database[0].Table.Row[0];$scope.hoursLocal=horarioApertura,$scope.$apply()},error:function(textStatus,err){console.log(err+" "+textStatus)}})}function reloadDataEstablishment(){Dataservice.GetToAllEstablecimientoUpdate().then(function(response){$scope.datosOfServices=response.data.result.Database[0].Table.Row[0],$scope.datapaginations=response.data.result.Database[0].Table.Row[0],$scope.NSelected=$scope.datapaginations,$scope.currentPage=0,$scope.pageSize=6,$scope.pages=[],$scope.pages.length=0;var ini=$scope.currentPage-10,fin=$scope.currentPage+10;ini<1?(ini=1,fin=Math.ceil($scope.datapaginations.length/$scope.pageSize)>10?5:Math.ceil($scope.datapaginations.length/$scope.pageSize)):ini>=Math.ceil($scope.datapaginations.length/$scope.pageSize)-10&&(ini=Math.ceil($scope.datapaginations.length/$scope.pageSize)-10,fin=Math.ceil($scope.datapaginations.length/$scope.pageSize)),ini<1&&(ini=1);for(var i=ini;i<=fin;i++)$scope.pages.push({num:i});$scope.currentPage>=$scope.pages.length&&($scope.currentPage=$scope.pages.length-1),$scope.setPage=function(index){$scope.currentPage=index-1}})}function sendUpdateEstablishment(datos){$.ajax({type:"POST",url:UrlUpdateEstablishment,timeout:2e3,data:datos,success:function(data){data_app=data,$scope.imagePrincipal=!1,reloadDataEstablishment(),alertify.set("notifier","position","top-right"),alertify.success("Se ha actualizado "+`<b>${$scope.nameEstablishment}</b>`)},error:function(textStatus,err){console.log(textStatus+""+err)}})}function sendUpdateHour(obj){$.ajax({type:"POST",url:UrlUpdateHour,timeout:2e3,data:obj,success:function(data){data_app=data,reloadDataEstablishment(),alertify.set("notifier","position","top-right"),alertify.success("Se ha actualizado el horario  del local "+`<b>${$scope.nameEstablishment}</b>`)},error:function(textStatus,err){console.log(textStatus+""+err)}})}function sendUpdateServices(datos){$.ajax({type:"POST",url:UrlUpdateService,timeout:2e3,data:datos,success:function(data){data_app=data,reloadDataEstablishment(),alertify.set("notifier","position","top-right"),alertify.success("Se ha actualizado Los sericios  del local "+`<b>${$scope.nameEstablishment}</b>`)},error:function(textStatus,err){console.log(textStatus+""+err)}})}function sendMethodPay(datos){$.ajax({type:"POST",url:UrlMethodPay,timeout:2e3,data:datos,success:function(data){data_app=data,reloadDataEstablishment(),alertify.set("notifier","position","top-right"),alertify.success("Se ha actualizado el metod de pago del local "+`<b>${$scope.nameEstablishment}</b>`)},error:function(textStatus,err){console.log(textStatus+""+err)}})}function UpdateImages(){$.ajax({type:"POST",url:UrlimagesUpdate,timeout:2e3,data:{id:document.getElementById("id").value},success:function(data){$scope.images=data.result.Database[0].Table.Row[0],alertify.set("notifier","position","top-right"),alertify.success("Se ha actualizado las Imagenes del local "+`<b>${$scope.nameEstablishment}</b>`),document.getElementById("updateImagesOne").value=$scope.images[0].imagenesEstablecimiento,document.getElementById("updateImagesTwo").value=value=$scope.images[1].imagenesEstablecimiento},error:function(textStatus,err){console.log(textStatus+""+err)}})}function FuncValidateProduction(dataService){1!=dataService.prod?$("#Producion").prop("disabled",!1):$("#Producion").prop("disabled",!0),1===dataService.prod?$("#QuitarProducion").prop("disabled",!1):$("#QuitarProducion").prop("disabled",!0)}function deleteobj(id){for(const key in $scope.datosOfServices)id===$scope.datosOfServices[key].establecimientID&&(delete $scope.datosOfServices[key],sendDelete(id))}function sendDelete(id){$.ajax({type:"POST",url:UrlDeleteLocal,timeout:2e3,data:{id:id},success:function(data){data_app=data,alertify.set("notifier","position","top-right"),alertify.success("Se ha Eliminado el local "+`<b>${$scope.nameEstablishment}</b> `+" de la base de datos "),$("#deleteModal").modal("hide"),reloadDataEstablishment()},error:function(textStatus,err){console.log(textStatus+""+err)}})}$scope.service=!0,$scope.information=!0,$scope.hours=!0,$scope.method=!0,$scope.production=!0,$scope.imagePrincipal=!0,$scope.hidePriview=!1,$scope.imagesOne=!0,$scope.imagesTwoHide=!0,$scope.formImages=!0,$scope.Users=objUserAdminRolOne,$scope.getDataService=function(data){var dataService=data.data;$scope.imagePrincipal=!0,loadData(dataService),loadHours(dataService),$scope.service=!1,$scope.information=!1,$scope.hours=!1,$scope.method=!1,$scope.formImages=!1},$scope.updateEstablishment=function(){var datos;sendUpdateEstablishment({id:document.getElementById("id").value,name:document.getElementById("nombre").value,direction:document.getElementById("direccion").value,price:document.getElementById("precio").value,tel:document.getElementById("telefono").value,mapa:document.getElementById("mapa").value,promociones:document.getElementById("promocion").value,imagenPrincipal:document.getElementById("nameImagen").value})},$scope.updateHour=function(){var datos=$("#horarios").serializeArray();datos.push({name:"id",value:$scope.id});var obj=new Object;for(const i in datos)obj[datos[i].name]=datos[i].value;sendUpdateHour(obj)},$scope.UpdateServices=function(){var datos;sendUpdateServices({servicePrincipal:document.getElementById("PrincipalService").value,services:document.getElementById("services").value,id:$scope.id})},$scope.updateMethodPay=function(){var datos;sendMethodPay({methodPay:document.getElementById("methodPay").value,id:$scope.id})},$scope.ProductionEstablishment=function(){$.ajax({type:"POST",url:UrlProductionService,timeout:2e3,data:{prod:1,id:$scope.id},success:function(data){data_app=data,alertify.set("notifier","position","top-right"),alertify.success("Se ha puesto en Produción el local "+`<b>${$scope.nameEstablishment}</b>`),$("#Producion").prop("disabled",!0),$("#QuitarProducion").prop("disabled",!1),reloadDataEstablishment()},error:function(textStatus,err){console.log(textStatus+""+err)}})},$scope.ProductionEstablishmentQuit=function(){$.ajax({type:"POST",url:UrlQuitProductionService,timeout:2e3,data:{prod:0,id:document.getElementById("id").value},success:function(data){data_app=data,alertify.set("notifier","position","top-right"),alertify.success("Se ha quitado de  Produción el local "+`<b>${$scope.nameEstablishment}</b>`),$("#Producion").prop("disabled",!1),$("#QuitarProducion").prop("disabled",!0),reloadDataEstablishment()},error:function(textStatus,err){console.log(textStatus+""+err)}})},$scope.SendupdateImages=function(){var data={imagesOne:document.getElementById("updateImagesOne").value,imagesTwo:document.getElementById("updateImagesTwo").value,idOne:$scope.images[0].id,idTwo:$scope.images[1].id};$.ajax({type:"POST",url:UrlUpdateEstablishmentImages,timeout:2e3,data:data,success:function(data){alertify.set("notifier","position","top-right"),alertify.success("Imagenes Actualizadas Para el local  "+`<b>${$scope.nameEstablishment}</b>`),$("#imagesTwoUpdate").hide(),$("#imagesOne").hide()},error:function(textStatus,err){console.log(textStatus+""+err)}})},""!=$scope.Users&&null!=$scope.Users||(location.href="/"),$scope.modal=((name,id)=>{$("#deleteModal").modal("show"),$scope.name=name,$scope.id=id}),$scope.deleteLocalGuialook=function(id){deleteobj(id)},$scope.showFormImgPrincipal=function(){$scope.imagePrincipal=!1,resetImages()},$scope.showImagesOne=function(){$scope.imagesOne=!1,$("#imagesOne").show(),preview.innerHTML=""},$scope.showImagesTwo=function(){$scope.imagesTwoHide=!1,$("#imagesTwoUpdate").show(),preview.innerHTML=""},reloadDataEstablishment()}]);